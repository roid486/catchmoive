<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="javajo">
  <select id="selectAll" resultType="boardVo">
    select b_number,b_title,b_pwd,b_content,b_hit,to_char(b_regdate,'YYYY-MM-DD hh24:mm:ss') b_regdate,b_ip,b_b_ref,b_b_level,b_b_step,b_fname,b_fsize,b_type,c_id from board
    <if test="keyword !=null and keyword !=''">
 		where ${searchField} like '%' || #{keyword} || '%'
 	</if>
  </select>

  <select id="getNextNo" resultType="java.lang.Integer">
  	select nvl(max(b_number),0)+1 from board
  </select>
  
  <select id="getNextRe" resultType="java.lang.Integer">
  	select nvl(max(re_number),0)+1 from reply
  </select>
  
  
  <insert id="insertBoard">
  	insert into board values(#{b_number}, #{b_title}, #{b_pwd}, #{b_content}, 0, sysdate, #{b_ip}, 0, 0, 0, #{b_fname}, #{b_fsize}, #{b_type}, 1 )
  </insert>
 
  <select id="getBoard" resultType="boardVo">
  	select * from board where b_number = #{b_number}
  </select>
  
  <update id="updateBoard">
  	update board set b_title=#{b_title},b_pwd=#{b_pwd},
  	b_content=#{b_content},b_fname=#{b_fname},b_type=#{b_type} where b_number=#{b_number}
  </update>
  
  <delete id="deleteBoard" >
  	delete from board where b_number=#{b_number}
  </delete>

  <update id="updateHit">
  	update board set b_hit = b_hit + 1 where b_number = #{b_number}
  </update>
  
  <update id="updateStep">
  	update board set b_b_step = b_b_step + 1 where b_b_ref= #{b_b_ref} and b_b_step > #{b_b_step}
  </update>
  

  <select id="selectRe" resultType="replyVo">
 	select * from reply r,customer c where r.c_id=c.c_id and b_number=#{b_number}
  </select>
  
  <insert id="insertRe">
	insert into reply(re_number,re_content,b_number,c_id) values(seq_reply.nextval,#{re_content},#{b_number},#{c_id})

    </insert>
  
	
</mapper>